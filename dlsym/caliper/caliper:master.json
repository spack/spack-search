{
    "matches": {
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/ext/gotcha/src/gotcha_dl.h": "#ifndef GOTCHA_DL_H\n#define GOTCHA_DL_H\n\n#include \"hash.h\"\n#include \"tool.h\"\n\nvoid handle_libdl();\nextern void update_all_library_gots(hash_table_t *bindings);\nextern int prepare_symbol(struct internal_binding_t *binding);\n\nextern gotcha_wrappee_handle_t orig_dlopen_handle;\nextern gotcha_wrappee_handle_t orig_dlsym_handle;\n\nextern struct gotcha_binding_t dl_binds[];\n#endif\n",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/ext/gotcha/src/gotcha_dl.c": "#define _GNU_SOURCE\n#include \"gotcha_dl.h\"\n#include \"tool.h\"\n#include \"libc_wrappers.h\"\n#include \"elf_ops.h\"\n#include <dlfcn.h>\n\nvoid* _dl_sym(void* handle, const char* name, void* where);\n\ngotcha_wrappee_handle_t orig_dlopen_handle;\ngotcha_wrappee_handle_t orig_dlsym_handle;\n\nstatic int per_binding(hash_key_t key, hash_data_t data, void *opaque KNOWN_UNUSED)\n{\n   int result;\n   struct internal_binding_t *binding = (struct internal_binding_t *) data;\n\n   debug_printf(3, \"Trying to re-bind %s from tool %s after dlopen\\n\",\n                binding->user_binding->name, binding->associated_binding_table->tool->tool_name);\n   \n   while (binding->next_binding) {\n      binding = binding->next_binding;\n      debug_printf(3, \"Selecting new innermost version of binding %s from tool %s.\\n\",\n                   binding->user_binding->name, binding->associated_binding_table->tool->tool_name);\n   }\n   \n   result = prepare_symbol(binding);\n   if (result == -1) {\n      debug_printf(3, \"Still could not prepare binding %s after dlopen\\n\", binding->user_binding->name);\n      return 0;\n   }\n\n   removefrom_hashtable(&notfound_binding_table, key);\n   return 0;\n}\n\nstatic void* dlopen_wrapper(const char* filename, int flags) {\n   typeof(&dlopen_wrapper) orig_dlopen = gotcha_get_wrappee(orig_dlopen_handle);\n   void *handle;\n   debug_printf(1, \"User called dlopen(%s, 0x%x)\\n\", filename, (unsigned int) flags);\n   handle = orig_dlopen(filename,flags);\n\n   debug_printf(2, \"Searching new dlopened libraries for previously-not-found exports\\n\");\n   foreach_hash_entry(&notfound_binding_table, NULL, per_binding);\n\n   debug_printf(2, \"Updating GOT entries for new dlopened libraries\\n\");\n   update_all_library_gots(&function_hash_table);\n  \n   return handle;\n}\n\nstatic void* dlsym_wrapper(void* handle, const char* symbol_name){\n  typeof(&dlsym_wrapper) orig_dlsym = gotcha_get_wrappee(orig_dlsym_handle);\n  struct internal_binding_t *binding;\n  int result;\n  \n  if(handle == RTLD_NEXT){\n    return _dl_sym(RTLD_NEXT, symbol_name ,__builtin_return_address(0));\n  }\n  \n  result = lookup_hashtable(&function_hash_table, (hash_key_t) symbol_name, (hash_data_t *) &binding);\n  if (result == -1)\n     return orig_dlsym(handle, symbol_name);\n  else\n     return binding->user_binding->wrapper_pointer;\n}\n\nstruct gotcha_binding_t dl_binds[] = {\n  {\"dlopen\", dlopen_wrapper, &orig_dlopen_handle},\n  {\"dlsym\", dlsym_wrapper, &orig_dlsym_handle}\n};     \nvoid handle_libdl(){\n  gotcha_wrap(dl_binds, 2, \"gotcha\");\n}\n\n"
    },
    "skipped": [
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/src/mpi/services/mpit/mpitdesign/design.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/src/mpi/services/mpit/mpitdesign/caliper.png",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/.git/objects/pack/pack-0cc7e11a7a59fdbabf1ad18d76e163c3fbf28e0d.pack",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/.git/objects/pack/pack-0cc7e11a7a59fdbabf1ad18d76e163c3fbf28e0d.idx",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/doc/sphinx/caliper-services-workflow.png",
        "/tmp/vanessa/spack-stage/spack-stage-caliper-master-iip76pylhm53pa2x3xovvcdd2d36wdvg/spack-src/doc/sphinx/caliper-logo-small.png"
    ],
    "total_files": 597
}