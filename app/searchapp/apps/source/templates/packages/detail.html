{% extends "base.html" %}

{% load static %}
{% load source_extras %}

{% block body %}
  <div class="container-fluid">
{% include "base/scrolltop.html" %}

{% if package_set %}
<div class="row" style="margin:25px; padding:30px">

    <!-- package list -->
    <div class="col-md-2">

     <a {% if previous %}href="{% url 'source:detail' previous %}"{% else %}disabled=""{% endif %} class="btn btn-xs btn-primary filter-button"><span>&nbsp;</span>◀ Previous</a>
                            <a {% if next %}href="{% url 'source:detail' next %}"{% else %}disabled=""{% endif %} class="btn btn-xs btn-primary filter-button"><span>&nbsp;</span>Next ▶</a>
      <div class="list-group list-group-root">
      <ul class="list-group" style='margin-top:20px'>
        {% for p in packages %}
        <li class="list-group-item"><a style="font-weight:600;{% if p == package_set.first.name %}margin-bottom:10px{% endif %}" href="{% url 'source:detail' p %}">{{ p }}</a>
           {% if p == package_set.first.name %}<ul class="list-group">
             {% for package in package_set.all %}<li class="list-group-item"><a href="#{{ package.name | slugify }}-{{ package.version }}">{{ package.version }}</a></li>{% endfor %}
              </ul>{% else %}</li>{% endif %}
        {% endfor %}
      </ul>
      </div>
    </div>

    <!-- Code items -->
    <div class="col-lg-10" id="code-results">
        <h1>{{ package_set.first.name }}</h1>
        {% for package in package_set.all %}
            <h2 style="padding-top:20px" id ="{{ package.name | slugify }}-{{ package.version }}">{{ package.version }}</h2>
            {% for sourcefile in package.sourcefile_set.all %}
            {% include "sourcefile/sourcelines.html" with sourcefile=sourcefile %}
            <br>
            {% endfor %}
        {% endfor %}
    </div>
</div>
{% else %}
  <p>No packages are available.</p>
{% endif %}

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="{% static 'source/js/autocomplete.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>

<script type="text/javascript">
    $(function () {

      var context = document.querySelector("#code-results");
      var instance = new Mark(context);
      instance.mark("dlopen");
      window.autocomplete = new Autocomplete({
        form_selector: '.autocomplete',
        url: '{% url 'source:autocomplete' %}'
      });
      window.autocomplete.setup()
    });
  </script>
</div>
{% endblock body %}
