{
    "matches": {
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/server/ldap_casa.c": "/* ldap_casa.c\n   \n   CASA routines for DHCPD... */\n\n/* Copyright (c) 2006 Novell, Inc.\n\n * All rights reserved.\n * Redistribution and use in source and binary forms, with or without \n * modification, are permitted provided that the following conditions are met: \n * 1.Redistributions of source code must retain the above copyright notice, \n *   this list of conditions and the following disclaimer. \n * 2.Redistributions in binary form must reproduce the above copyright notice, \n *   this list of conditions and the following disclaimer in the documentation \n *   and/or other materials provided with the distribution. \n * 3.Neither the name of ISC, ISC DHCP, nor the names of its contributors \n *   may be used to endorse or promote products derived from this software \n *   without specific prior written permission. \n\n * THIS SOFTWARE IS PROVIDED BY INTERNET SYSTEMS CONSORTIUM AND CONTRIBUTORS \n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR \n * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL ISC OR CONTRIBUTORS BE LIABLE \n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL \n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR \n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) \n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN \n * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \n * POSSIBILITY OF SUCH DAMAGE.\n\n * This file was written by S Kalyanasundaram <skalyanasundaram@novell.com>\n */\n\n/*\n * Copyright (c) 2004-2010 by Internet Systems Consortium, Inc. (\"ISC\")\n * Copyright (c) 1995-2003 by Internet Software Consortium\n *\n * Permission to use, copy, modify, and distribute this software for any\n * purpose with or without fee is hereby granted, provided that the above\n * copyright notice and this permission notice appear in all copies.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\" AND ISC DISCLAIMS ALL WARRANTIES\n * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR\n * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT\n * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n *\n *   Internet Systems Consortium, Inc.\n *   950 Charter Street\n *   Redwood City, CA 94063\n *   <info@isc.org>\n *   https://www.isc.org/\n */\n\n#if defined(LDAP_CASA_AUTH)\n#include \"dhcpd.h\"\n#include \"ldap_casa.h\"\n#include <dlfcn.h>\n#include <string.h>\n\nint\nload_casa (void)\n{\n       if( !(casaIDK = dlopen(MICASA_LIB,RTLD_LAZY)))\n       \t  return 0;\n       p_miCASAGetCredential = (CASA_GetCredential_T) dlsym(casaIDK, \"miCASAGetCredential\");\n       p_miCASASetCredential = (CASA_SetCredential_T) dlsym(casaIDK, \"miCASASetCredential\");\n       p_miCASARemoveCredential = (CASA_RemoveCredential_T) dlsym(casaIDK, \"miCASARemoveCredential\");\n\n       if((p_miCASAGetCredential == NULL) ||\n         (p_miCASASetCredential == NULL) ||\n         (p_miCASARemoveCredential == NULL))\n       {\n          if(casaIDK)\n            dlclose(casaIDK);\n          casaIDK = NULL;\n          p_miCASAGetCredential = NULL;\n          p_miCASASetCredential = NULL;\n          p_miCASARemoveCredential = NULL;\n          return 0;\n       }\n       else\n          return 1;\n}\n\nstatic void\nrelease_casa(void)\n{\n   if(casaIDK)\n   {\n      dlclose(casaIDK);\n      casaIDK = NULL;\n   }\n\n   p_miCASAGetCredential = NULL;\n   p_miCASASetCredential = NULL;\n   p_miCASARemoveCredential = NULL;\n\n}\n\nint\nload_uname_pwd_from_miCASA (char **ldap_username, char **ldap_password)\n {\n   int                     result = 0;\n   uint32_t                credentialtype = SSCS_CRED_TYPE_SERVER_F;\n   SSCS_BASIC_CREDENTIAL   credential;\n   SSCS_SECRET_ID_T        applicationSecretId;\n   char                    *tempVar = NULL;\n\n   const char applicationName[10] = \"dhcp-ldap\";\n\n   if ( load_casa() )\n   {\n      memset(&credential, 0, sizeof(SSCS_BASIC_CREDENTIAL));\n      memset(&applicationSecretId, 0, sizeof(SSCS_SECRET_ID_T));\n\n      applicationSecretId.len = strlen(applicationName) + 1;\n      memcpy (applicationSecretId.id, applicationName, applicationSecretId.len);\n\n      credential.unFlags = USERNAME_TYPE_CN_F;\n\n      result = p_miCASAGetCredential (0,\n                 &applicationSecretId,NULL,&credentialtype,\n                 &credential,NULL);\n\n      if(credential.unLen)\n      {\n         tempVar = dmalloc (credential.unLen + 1, MDL);\n         if (!tempVar)\n             log_fatal (\"no memory for ldap_username\");\n         memcpy(tempVar , credential.username, credential.unLen);\n         *ldap_username = tempVar;\n\n         tempVar = dmalloc (credential.pwordLen + 1, MDL);\n         if (!tempVar)\n             log_fatal (\"no memory for ldap_password\");\n         memcpy(tempVar, credential.password, credential.pwordLen);\n         *ldap_password = tempVar;\n\n#if defined (DEBUG_LDAP)\n         log_info (\"Authentication credential taken from CASA\");\n#endif\n\n         release_casa();\n         return 1;\n\n        }\n        else\n        {\n            release_casa();\n            return 0;\n        }\n      }\n      else\n          return 0; //casa libraries not loaded\n }\n\n#endif /* LDAP_CASA_AUTH */\n\n"
    },
    "skipped": [
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/bind/bind.tar.gz",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhcp-eval.5",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhcp-options.5",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhclient.conf.5",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhclient-script.8",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhclient.leases.5",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/ja_JP.eucJP/dhclient.8",
        "/tmp/vanessa/spack-stage/spack-stage-isc-dhcp-4.3.5-icntgvmei3dcwqrv7l2kyzxmh2k46xxc/spack-src/doc/devel/isc-logo.jpg"
    ],
    "total_files": 239
}