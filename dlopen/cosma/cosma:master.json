{
    "matches": {
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docker/gpu/deploy.Dockerfile": "ARG BUILD_ENV\n\nFROM $BUILD_ENV as builder\n\nARG BLAS\n\n# Build COSMA\nCOPY . /COSMA\n\nRUN mkdir /COSMA/build && cd /COSMA/build && \\\n    CC=mpicc CXX=mpicxx cmake .. \\\n      -DCOSMA_WITH_TESTS=ON \\\n      -DCUDA_PATH=/usr/local/cuda \\\n      -DCOSMA_BLAS=CUDA \\\n      -DCOSMA_SCALAPACK=CUSTOM \\\n      -DCMAKE_BUILD_TYPE=Release \\\n      -DCMAKE_INSTALL_PREFIX=/usr && \\\n      make -j$(nproc) && \\\n      make DESTDIR=/root/COSMA-build install && \\\n      rm -rf /COSMA\n\n# Run linuxdeploy, and add a bunch of libs that are dlopen'ed by mkl\nRUN /root/libtree/libtree \\\n      -d /root/COSMA.bundle/ \\\n      --chrpath \\\n      --strip \\\n      /root/COSMA-build/usr/bin/test.cosma \\\n      /root/COSMA-build/usr/bin/test.mapper \\\n      /root/COSMA-build/usr/bin/test.multiply \\\n      /root/COSMA-build/usr/bin/test.multiply_using_layout \\\n      /root/COSMA-build/usr/bin/test.pdgemm \\\n      /root/COSMA-build/usr/bin/test.scalar_matmul\n\nFROM ubuntu:18.04\n\n# This is the only thing necessary really from nvidia/cuda's ubuntu18.04 runtime image\nENV NVIDIA_VISIBLE_DEVICES all\nENV NVIDIA_DRIVER_CAPABILITIES compute,utility\nENV NVIDIA_REQUIRE_CUDA \"cuda>=10.1 brand=tesla,driver>=384,driver<385 brand=tesla,driver>=396,driver<397 brand=tesla,driver>=410,driver<411\"\n\nCOPY --from=builder /root/COSMA.bundle /root/COSMA.bundle\n\n# Make it easy to call our binaries.\nENV PATH=\"/root/COSMA.bundle/usr/bin:$PATH\"\n\nRUN echo \"/root/COSMA.bundle/usr/lib/\" > /etc/ld.so.conf.d/cosma.conf && ldconfig\n\nWORKDIR /root/COSMA.bundle/usr/bin\n",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docker/cpu-release/deploy.Dockerfile": "ARG BUILD_ENV\n\nFROM $BUILD_ENV as builder\n\n# Build COSMA\nCOPY . /COSMA\n\nRUN COMPILERVARS_ARCHITECTURE=intel64 /opt/intel/bin/compilervars.sh && \\\n    mkdir /COSMA/build && cd /COSMA/build && \\\n    CC=mpicc CXX=mpicxx cmake .. \\\n      -DCOSMA_WITH_TESTS=ON \\\n      -DCUDA_PATH=/usr/local/cuda \\\n      -DCOSMA_BLAS=MKL \\\n      -DCOSMA_SCALAPACK=MKL \\\n      -DCMAKE_BUILD_TYPE=Release \\\n      -DCMAKE_INSTALL_PREFIX=/usr && \\\n      make -j$(nproc) && \\\n      make DESTDIR=/root/COSMA-build install && \\\n      rm -rf /COSMA\n\nENV MKL_LIB=/opt/intel/compilers_and_libraries/linux/mkl/lib/intel64\n\n# Run linuxdeploy, and add a bunch of libs that are dlopen'ed by mkl\nRUN /root/libtree/libtree --chrpath --strip -d /root/COSMA.bundle/ \\\n      /root/COSMA-build/usr/bin/test.cosma \\\n      /root/COSMA-build/usr/bin/test.mapper \\\n      /root/COSMA-build/usr/bin/test.multiply \\\n      /root/COSMA-build/usr/bin/test.multiply_using_layout \\\n      /root/COSMA-build/usr/bin/test.pdgemm \\\n      /root/COSMA-build/usr/bin/test.scalar_matmul \\\n      # MKL dlopen's some of their libs, so we have to explicitly copy them over\n      ${MKL_LIB}/libmkl_avx.so \\\n      ${MKL_LIB}/libmkl_avx2.so \\\n      ${MKL_LIB}/libmkl_avx512_mic.so \\\n      ${MKL_LIB}/libmkl_avx512.so \\\n      ${MKL_LIB}/libmkl_core.so \\\n      ${MKL_LIB}/libmkl_def.so \\\n      ${MKL_LIB}/libmkl_intel_thread.so \\\n      ${MKL_LIB}/libmkl_mc.so \\\n      ${MKL_LIB}/libmkl_mc3.so \\\n      ${MKL_LIB}/libmkl_sequential.so \\\n      ${MKL_LIB}/libmkl_tbb_thread.so \\\n      ${MKL_LIB}/libmkl_vml_avx.so \\\n      ${MKL_LIB}/libmkl_vml_avx2.so \\\n      ${MKL_LIB}/libmkl_vml_avx512_mic.so \\\n      ${MKL_LIB}/libmkl_vml_avx512.so \\\n      ${MKL_LIB}/libmkl_vml_cmpt.so \\\n      ${MKL_LIB}/libmkl_vml_def.so \\\n      ${MKL_LIB}/libmkl_vml_mc.so \\\n      ${MKL_LIB}/libmkl_vml_mc3.so\n\nFROM ubuntu:18.04\n\nCOPY --from=builder /root/COSMA.bundle /root/COSMA.bundle\n\n# Make it easy to call our binaries.\nENV PATH=\"/root/COSMA.bundle/usr/bin:$PATH\"\n\nRUN echo \"/root/COSMA.bundle/usr/lib/\" > /etc/ld.so.conf.d/cosma.conf && ldconfig\n\nWORKDIR /root/COSMA.bundle/usr/bin\n"
    },
    "skipped": [
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/libs/COSTA/docs/cscs-logo.jpg",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/libs/Tiled-MM/docs/performance.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/objects/pack/pack-bfd884e47af047d018308342de33d8871cbae8fd.pack",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/objects/pack/pack-bfd884e47af047d018308342de33d8871cbae8fd.idx",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/COSTA/objects/pack/pack-8ae55ecc7f40ba7f4674d17ded73ff5917e7124f.pack",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/COSTA/objects/pack/pack-8ae55ecc7f40ba7f4674d17ded73ff5917e7124f.idx",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/Tiled-MM/objects/pack/pack-ef058b1406d8e25ecb776040357656772a47deb7.pack",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/Tiled-MM/objects/pack/pack-ef058b1406d8e25ecb776040357656772a47deb7.idx",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/semiprof/objects/pack/pack-74e0abc79b03dd4c2e649ebab894f9d0ad336518.idx",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/.git/modules/libs/semiprof/objects/pack/pack-74e0abc79b03dd4c2e649ebab894f9d0ad336518.pack",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/cp2k-benchmark.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/max-logo-2.jpg",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/max-logo.jpg",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/square-results.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/cscs-logo.jpg",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/pasc-logo.png",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/cosma-logo.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/erc-logo.png",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/cp2k-results-128.pdf",
        "/tmp/vanessa/spack-stage/spack-stage-cosma-master-ej4xkuxcrfg2ebwtqstt4agtkon5mrbc/spack-src/docs/cp2k-results-1024.pdf"
    ],
    "total_files": 407
}